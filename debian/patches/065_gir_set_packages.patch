From 18da1070da369db9c8bdef175abeb1842782a92b Mon Sep 17 00:00:00 2001
From: Abderrahim Kitouni <a.kitouni@gmail.com>
Date: Sat, 4 Dec 2010 11:34:21 +0100
Subject: [PATCH] add package and C include information to the gir file (needed by vala)

https://bugzilla.gnome.org/show_bug.cgi?id=635287

=== modified file 'gdk/Makefile.am'
--- old/gdk/Makefile.am	2011-01-20 19:28:34 +0000
+++ new/gdk/Makefile.am	2011-01-20 19:32:34 +0000
@@ -3,7 +3,7 @@
 -include $(INTROSPECTION_MAKEFILE)
 INTROSPECTION_GIRS =
 INTROSPECTION_SCANNER_ARGS = \
-   --add-include-path=../gdk
+   --warn-all
 INTROSPECTION_COMPILER_ARGS = \
    --includedir=$(srcdir) \
    --includedir=.
@@ -184,11 +184,12 @@
         gdkenumtypes.h
 
 Gdk-3.0.gir: libgdk-3.0.la Makefile
-Gdk_3_0_gir_SCANNERFLAGS = --warn-all --c-include="gdk/gdk.h"
+Gdk_3_0_gir_SCANNERFLAGS = --c-include="gdk/gdk.h"
 Gdk_3_0_gir_INCLUDES = Gio-2.0 GdkPixbuf-2.0 Pango-1.0 cairo-1.0
 Gdk_3_0_gir_LIBS = libgdk-3.0.la
 Gdk_3_0_gir_FILES = $(introspection_files)
 Gdk_3_0_gir_CFLAGS = $(INCLUDES)
+Gdk_3_0_gir_EXPORT_PACKAGES = gdk-3.0
 INTROSPECTION_GIRS += Gdk-3.0.gir
 
 if USE_X11
@@ -233,11 +234,12 @@
 	x11/gdkx11window.h
 
 GdkX11-3.0.gir: libgdk-3.0.la Gdk-3.0.gir Makefile
-GdkX11_3_0_gir_SCANNERFLAGS = --warn-all --strip-prefix=Gdk --c-include="gdk/gdkx.h"
-GdkX11_3_0_gir_INCLUDES = Gio-2.0 Gdk-3.0 GdkPixbuf-2.0 Pango-1.0 xlib-2.0
+GdkX11_3_0_gir_SCANNERFLAGS = --identifier-prefix=Gdk --include-uninstalled=Gdk-3.0.gir
+GdkX11_3_0_gir_INCLUDES = Gio-2.0 GdkPixbuf-2.0 Pango-1.0 xlib-2.0
 GdkX11_3_0_gir_LIBS = libgdk-3.0.la
 GdkX11_3_0_gir_FILES = $(x11_introspection_files)
 GdkX11_3_0_gir_CFLAGS = $(INCLUDES) -L$(top_builddir)/gdk
+GdkX11_3_0_gir_EXPORT_PACKAGES = gdk-x11-3.0
 INTROSPECTION_GIRS += GdkX11-3.0.gir
 
 endif # USE_X11

=== modified file 'gtk/Makefile.am'
--- old/gtk/Makefile.am	2011-01-20 19:28:34 +0000
+++ new/gtk/Makefile.am	2011-01-20 19:33:46 +0000
@@ -3,7 +3,7 @@
 -include $(INTROSPECTION_MAKEFILE)
 INTROSPECTION_GIRS =
 INTROSPECTION_SCANNER_ARGS = \
-	--add-include-path=../gdk
+	--warn-all
 INTROSPECTION_COMPILER_ARGS = \
 	--includedir=$(srcdir) \
     --includedir=. \
@@ -968,12 +968,12 @@
     gtktypebuiltins.c
 
 Gtk-3.0.gir: $(INTROSPECTION_SCANNER) libgtk-3.0.la $(top_builddir)/gdk/Gdk-3.0.gir Makefile
-Gtk_3_0_gir_SCANNERFLAGS = --warn-all --add-include-path=$(top_builddir)/gdk
+Gtk_3_0_gir_SCANNERFLAGS = --include-uninstalled=$(top_builddir)/gdk/Gdk-3.0.gir
+Gtk_3_0_gir_INCLUDES = Atk-1.0
 if USE_X11
 Gtk_3_0_gir_SCANNERFLAGS += --add-include-path=$(top_builddir)/gdk/x11
 endif
 Gtk_3_0_gir_SCANNERFLAGS += --c-include="gtk/gtk.h"
-Gtk_3_0_gir_INCLUDES = Atk-1.0 Gdk-3.0
 Gtk_3_0_gir_CFLAGS = \
 		$(INCLUDES) \
 		-UGDK_DISABLE_DEPRECATED \
@@ -981,6 +981,7 @@
 		-DGTK_TEXT_USE_INTERNAL_UNSUPPORTED_API
 Gtk_3_0_gir_LIBS = libgtk-3.0.la
 Gtk_3_0_gir_FILES = $(introspection_files)
+Gtk_3_0_gir_EXPORT_PACKAGES = gtk+-3.0
 INTROSPECTION_GIRS += Gtk-3.0.gir
 
 girdir = $(datadir)/gir-1.0

