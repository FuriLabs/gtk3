## Description: Adding two signals that are needed for Application Indicator to
##              keep up-to-date with changed GtkMenu(Item)s.
## Origin/Author: Cody Russell <bratsche@gnome.org>, 
##                Sense Hofstede <sense@ubuntu.com>
## Bug: unknown and https://launchpad.net/bugs/608219
diff -Nur gtk+3.0-2.91.0/gtk/gtkcontainer.c gtk+3.0-2.91.0ubuntu/gtk/gtkcontainer.c
--- gtk+3.0-2.91.0/gtk/gtkcontainer.c	2010-09-28 02:39:58.000000000 +0200
+++ gtk+3.0-2.91.0ubuntu/gtk/gtkcontainer.c	2010-10-12 16:49:29.000000000 +0200
@@ -61,6 +61,8 @@
   REMOVE,
   CHECK_RESIZE,
   SET_FOCUS_CHILD,
+  CHILD_ADDED,
+  CHILD_REMOVED,
   LAST_SIGNAL
 };
 
@@ -312,6 +314,24 @@
 		  _gtk_marshal_VOID__OBJECT,
 		  G_TYPE_NONE, 1,
 		  GTK_TYPE_WIDGET);
+  container_signals[CHILD_ADDED] =
+    g_signal_new (I_("child-added"),
+                  G_OBJECT_CLASS_TYPE (gobject_class),
+                  G_SIGNAL_RUN_LAST,
+                  0,
+                  NULL, NULL,
+                  _gtk_marshal_VOID__OBJECT,
+                  G_TYPE_NONE, 1,
+                  GTK_TYPE_WIDGET);
+  container_signals[CHILD_REMOVED] =
+    g_signal_new (I_("child-removed"),
+                  G_OBJECT_CLASS_TYPE (gobject_class),
+                  G_SIGNAL_RUN_LAST,
+                  0,
+                  NULL, NULL,
+                  _gtk_marshal_VOID__OBJECT,
+                  G_TYPE_NONE, 1,
+                  GTK_TYPE_WIDGET);
 
   g_type_class_add_private (class, sizeof (GtkContainerPrivate));
 }
diff -Nur gtk+3.0-2.91.0/gtk/gtkmenuitem.c gtk+3.0-2.91.0ubuntu/gtk/gtkmenuitem.c
--- gtk+3.0-2.91.0/gtk/gtkmenuitem.c	2010-10-12 16:53:11.503795431 +0200
+++ gtk+3.0-2.91.0ubuntu/gtk/gtkmenuitem.c	2010-10-12 17:00:33.000000000 +0200
@@ -52,6 +52,8 @@
   TOGGLE_SIZE_ALLOCATE,
   SELECT,
   DESELECT,
+  SUBMENU_ADDED,
+  SUBMENU_REMOVED,
   LAST_SIGNAL
 };
 
@@ -272,6 +274,25 @@
                   _gtk_marshal_VOID__VOID,
                   G_TYPE_NONE, 0);
 
+  menu_item_signals[SUBMENU_ADDED] =
+    g_signal_new (I_("submenu-added"),
+		  G_OBJECT_CLASS_TYPE (gobject_class),
+		  G_SIGNAL_RUN_FIRST,
+ 		  0,
+		  NULL, NULL,
+		  _gtk_marshal_VOID__OBJECT,
+		  G_TYPE_NONE, 1,
+		  GTK_TYPE_WIDGET);
+ 
+ menu_item_signals[SUBMENU_REMOVED] =
+    g_signal_new (I_("submenu-removed"),
+		  G_OBJECT_CLASS_TYPE (gobject_class),
+		  G_SIGNAL_RUN_FIRST,
+ 		  0,
+		  NULL, NULL,
+		  _gtk_marshal_VOID__VOID,
+		  G_TYPE_NONE, 0);
+
   /**
    * GtkMenuItem:right-justified:
    *
@@ -1202,6 +1223,11 @@
       if (gtk_widget_get_parent (GTK_WIDGET (menu_item)))
 	gtk_widget_queue_resize (GTK_WIDGET (menu_item));
 
+      if(submenu == NULL)
+        g_signal_emit_by_name (menu_item, "submenu-removed");
+      else
+        g_signal_emit_by_name (menu_item, "submenu-added", GTK_WIDGET(submenu));
+
       g_object_notify (G_OBJECT (menu_item), "submenu");
     }
 }
diff -Nur gtk+3.0-2.91.0/gtk/gtkmenushell.c gtk+3.0-2.91.0ubuntu/gtk/gtkmenushell.c
--- gtk+3.0-2.91.0/gtk/gtkmenushell.c	2010-10-12 16:53:11.507795450 +0200
+++ gtk+3.0-2.91.0ubuntu/gtk/gtkmenushell.c	2010-10-12 16:53:56.000000000 +0200
@@ -559,6 +559,8 @@
                               GTK_WIDGET (menu_shell),
                               child,
                               position);
+
+  g_signal_emit_by_name (menu_shell, "child-added", child);
 }
 
 static void
