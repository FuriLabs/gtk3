From 646f6ef30e4b01b1f2ebbdb8ab507ee7d174a460 Mon Sep 17 00:00:00 2001
From: Didier Roche <didrocks@ubuntu.com>
Date: Thu, 7 Oct 2010 16:39:33 +0200
Subject: [PATCH] add a function to expose GtkMenuShell::active_menu_item

We can have some cases where we want to know which is the selected
menuitem in a GtkMenuShell before it became activated.
Adding a gtk_menu_shell_get_selected_item to the API to get it.
---
 gtk/gtk.symbols    |    1 +
 gtk/gtkmenushell.c |   21 +++++++++++++++++++++
 gtk/gtkmenushell.h |    1 +
 3 files changed, 23 insertions(+), 0 deletions(-)

diff --git a/gtk/gtk.symbols b/gtk/gtk.symbols
index 3336e51..fce5e72 100644
--- a/gtk/gtk.symbols
+++ b/gtk/gtk.symbols
@@ -1965,6 +1965,7 @@ gtk_menu_shell_select_first
 gtk_menu_shell_select_item
 gtk_menu_shell_set_take_focus
 gtk_menu_shell_get_take_focus
+gtk_menu_shell_get_selected_item
 #endif
 #endif
 
diff --git a/gtk/gtkmenushell.c b/gtk/gtkmenushell.c
index e531de1..b85fbd8 100644
--- a/gtk/gtkmenushell.c
+++ b/gtk/gtkmenushell.c
@@ -1266,6 +1266,27 @@ gtk_menu_shell_deselect (GtkMenuShell *menu_shell)
     }
 }
 
+/**
+ * gtk_menu_shell_get_selected_item:
+ * @menu_shell: a #GtkMenuShell
+ *
+ * Retrieves a pointer to the selected menuitem, or %NULL
+ * if there is no menuitem selected. A selected menuitem is
+ * one that is displayed in the prelight state for that menu.
+ *
+ * Return value: a #GtkWidget or %NULL in case there is no
+ * selected menuitem
+ *
+ * Since: 2.24
+ **/
+GtkWidget *
+gtk_menu_shell_get_selected_item (GtkMenuShell *menu_shell)
+{
+  g_return_val_if_fail (GTK_IS_MENU_SHELL (menu_shell), NULL);
+
+  return menu_shell->active_menu_item;
+}
+
 void
 gtk_menu_shell_activate_item (GtkMenuShell      *menu_shell,
 			      GtkWidget         *menu_item,
diff --git a/gtk/gtkmenushell.h b/gtk/gtkmenushell.h
index d9b2307..1229d40 100644
--- a/gtk/gtkmenushell.h
+++ b/gtk/gtkmenushell.h
@@ -112,6 +112,7 @@ void  gtk_menu_shell_deselect          (GtkMenuShell *menu_shell);
 void  gtk_menu_shell_activate_item     (GtkMenuShell *menu_shell,
 					GtkWidget    *menu_item,
 					gboolean      force_deactivate);
+GtkWidget *gtk_menu_shell_get_selected_item (GtkMenuShell *menu_shell);
 void  gtk_menu_shell_select_first      (GtkMenuShell *menu_shell,
 					gboolean      search_sensitive);
 void _gtk_menu_shell_select_last       (GtkMenuShell *menu_shell,
-- 
1.7.1

