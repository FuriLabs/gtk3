From: =?utf-8?q?Jonas_=C3=85dahl?= <jadahl@gmail.com>
Date: Mon, 6 Apr 2020 14:20:43 +0200
Subject: wayland: Always store unconfigured size

This means it'll always be as up to date GdkWindow::width/height. We
still skip the resize for non-configured windows though, to avoid
mapping with the wrong size.

The commit f06ee688fe86ec8e1db1c515a7bf2ccc8decc310 also accidentally
removed the unconfigured size setting completely, so this essentially
adds it back, but always sets it.

Bug: https://gitlab.gnome.org/GNOME/gtk/-/issues/2582
Forwarded: https://gitlab.gnome.org/GNOME/gtk/-/merge_requests/1638
Origin: upstream, 3.24.18
---
 gdk/wayland/gdkwindow-wayland.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/gdk/wayland/gdkwindow-wayland.c b/gdk/wayland/gdkwindow-wayland.c
index f6acc743..30d4353 100644
--- a/gdk/wayland/gdkwindow-wayland.c
+++ b/gdk/wayland/gdkwindow-wayland.c
@@ -1156,6 +1156,8 @@ gdk_wayland_window_maybe_configure (GdkWindow *window,
   gboolean is_xdg_popup;
   gboolean is_visible;
 
+  impl->unconfigured_width = calculate_width_without_margin (window, width);
+  impl->unconfigured_height = calculate_height_without_margin (window, height);
 
   if (should_inhibit_resize (window))
     return;
