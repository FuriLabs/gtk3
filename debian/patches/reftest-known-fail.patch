From: Michael Biebl <biebl@debian.org>
Date: Mon, 2 May 2016 01:18:04 +0200
Subject: Mark known failing tests as non-fatal

Forwarded: no
---
 testsuite/reftests/gtk-reftest.c | 22 +++++++++++++++++++++-
 1 file changed, 21 insertions(+), 1 deletion(-)

diff --git a/testsuite/reftests/gtk-reftest.c b/testsuite/reftests/gtk-reftest.c
index 1a51a97..fb5d243 100644
--- a/testsuite/reftests/gtk-reftest.c
+++ b/testsuite/reftests/gtk-reftest.c
@@ -260,6 +260,20 @@ get_test_keyfile (const char *ui_file)
   return get_test_file (ui_file, ".keyfile", TRUE);
 }
 
+static gboolean
+known_fail(const char *test_name)
+{
+  char *filename = get_test_file (test_name, ".ui.known_fail", TRUE);
+
+  if (filename)
+    {
+      g_free (filename);
+      return TRUE;
+    }
+
+  return FALSE;
+}
+
 static void
 test_ui_file (GFile *file)
 {
@@ -291,6 +305,13 @@ test_ui_file (GFile *file)

   if (diff_image)
     {
+      if (known_fail(ui_file))
+        {
+          printf("KNOWN FAIL: ");
+          g_test_message ("KNOWN FAIL: %s", ui_file);
+          remove_extra_css (provider);
+          return;
+        }
       char *keyfile_path = get_test_keyfile (ui_file);
       GKeyFile *keyfile = g_key_file_new ();
       guint64 tolerated_diff = 0;
